<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA Space Apps Challenge - Forecast Soil Conditions</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Leaflet Heatmap Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 500px;
            width: 100%;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="">
            <img src="https://upload.wikimedia.org/wikipedia/commons/e/e5/NASA_logo.svg" alt="Logo">
        </a>
    </div>
</nav>

<!-- Jumbotron -->
<div class="jumbotron">
    <h1>Forecast Soil Conditions</h1>
    <p>Get accurate soil condition forecasts to help make informed decisions regarding crop selection, planting, and fertilization.</p>
</div>

<!-- Main content -->
<div class="container my-5">
    <!-- Map Section -->
    <div id="map"></div>
    <button id="loadSoilMoisture" class="btn btn-primary mt-3">Load Soil Moisture Data</button>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    // Initialize the map
    var map = L.map('map').setView([42.3154, -83.0364], 6);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Load soil moisture data and create visualization
    document.getElementById('loadSoilMoisture').addEventListener('click', function() {
        fetch('/soil_moisture_data')
        .then(response => response.json())
        .then(data => {
            // Create heatmap data from response
            var heatData = data.map(function(point) {
                return [point.lat, point.lon, point.value];
            });

            // Adding heat layer to map
            var heat = L.heatLayer(heatData, {
                radius: 25,
                blur: 15,
                maxZoom: 10,
                gradient: {
                    0.2: 'blue',
                    0.4: 'lime',
                    0.6: 'yellow',
                    0.8: 'orange',
                    1.0: 'red'
                }
            }).addTo(map);

            // Adding markers for each data point
            data.forEach(function(point) {
                var color = point.value > 0.6 ? 'red' : point.value > 0.3 ? 'orange' : 'green';
                L.circleMarker([point.lat, point.lon], {
                    radius: 8,
                    fillColor: color,
                    color: '#000',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map)
                .bindPopup(`Soil Moisture: ${point.value}`);
            });
        });
    });
</script>
</body>
</html>
